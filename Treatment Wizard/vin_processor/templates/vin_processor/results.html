{% extends 'vin_processor/base.html' %}

{% block title %}×ª×•×¦××•×ª - {{ vin }}{% endblock %}

{% block extra_css %}
<style>
    .header-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
    }
    
    .header-info h2 {
        margin: 0;
        font-size: 1.8em;
    }
    
    .header-info p {
        margin: 10px 0 0 0;
        font-size: 1.2em;
    }
    
    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #e0e0e0;
        flex-wrap: wrap;
    }
    
    .tab {
        padding: 15px 25px;
        background: white;
        border: none;
        cursor: pointer;
        font-size: 1.1em;
        border-radius: 8px 8px 0 0;
        transition: all 0.3s;
    }
    
    .tab:hover {
        background: #f5f5f5;
    }
    
    .tab.active {
        background: #667eea;
        color: white;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    th {
        background: #667eea;
        color: white;
        padding: 15px;
        text-align: right;
        font-size: 1.1em;
    }
    
    td {
        padding: 12px 15px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    tr:hover {
        background: #f9f9f9;
    }
    
    .service-info {
        background: #f0f0f0;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .service-info strong {
        font-size: 1.2em;
        color: #667eea;
    }
    
    .back-btn {
        display: inline-block;
        margin-top: 20px;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="header-info">
        <h2>ğŸ“‹ ×ª×•×¦××•×ª ×¢×‘×•×¨ VIN: {{ vin }}</h2>
        <p><strong>×“×’×:</strong> {{ model }}</p>
        <p><strong>×§×™×‘×•×œ×ª ×©××Ÿ:</strong> {{ oil_capacity }} ×œ×™×˜×¨</p>
    </div>
    
    <div class="tabs">
        {% for km, service_data in services.items %}
        <button class="tab {% if forloop.first %}active{% endif %}" 
                onclick="showTab('tab{{ km }}')">
            {{ service_data.mileage_km|floatformat:0 }} ×§"×
        </button>
        {% endfor %}
    </div>
    
    {% for km, service_data in services.items %}
    <div id="tab{{ km }}" class="tab-content {% if forloop.first %}active{% endif %}">
        <div class="service-info">
            <strong>×˜×™×¤×•×œ ××¡×¤×¨:</strong> {{ service_data.service_number }} | 
            <strong>×§×™×œ×•××˜×¨××–':</strong> {{ service_data.mileage_km|floatformat:0 }} ×§"×
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>×©×•×¨×ª ×©×™×¨×•×ª</th>
                    <th>××¡×¤×¨ ×—×œ×§</th>
                    <th>×ª×™××•×¨</th>
                    <th>×”×¢×¨×”</th>
                    <th>×›××•×ª</th>
                </tr>
            </thead>
            <tbody>
                {% for part in service_data.matched_parts %}
                <tr>
                    <td>{{ part.SERVICE_LINE }}</td>
                    <td><strong>{{ part.PART_NUMBER }}</strong></td>
                    <td>{{ part.DESCRIPTION }}</td>
                    <td>{{ part.REMARK|default:"â€”" }}</td>
                    <td>{{ part.QUANTITY }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}
    
    <a href="{% url 'home' %}" class="back-btn btn">×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function showTab(tabId) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active from all buttons
        document.querySelectorAll('.tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(tabId).classList.add('active');
        
        // Mark button as active
        event.target.classList.add('active');
    }
</script>
{% endblock %}
